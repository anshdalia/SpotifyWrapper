<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ year }} Duo Wrapped: {{ user1.username }} & {{ user2.username }}</title>
    {% load static %}
    {% load wrap_filters %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="{% static 'custom/duo_wrap.css' %}" rel="stylesheet">
</head>
<body>
    <div class="carousel-container">
        <!-- Welcome Slide -->
        <div class="carousel-slide welcome-slide active">
            <div class="slide-content" style="height: 100vh; justify-content: flex-start; margin-top: 20vh;">
                <div class="title animate__animated animate__fadeInUp">Your {{ duo_wrap.wrap_name }}</div>
                <div class="subtitle animate__animated animate__fadeInUp">{{ duo_wrap.user1.username }} & {{ duo_wrap.user2.username }}'s Musical Journey</div>
                <div class="highlight animate__animated animate__zoomIn">Ready to explore?</div>
            </div>
        </div>

        <div class="carousel-slide transition-artists">
            <div class="slide-content">
                <svg class="transition-graphic pulse" viewBox="0 0 100 100">
                    <circle cx="25" cy="50" r="15" stroke="white" fill="none" stroke-width="2"/>
                    <circle cx="75" cy="50" r="15" stroke="white" fill="none" stroke-width="2"/>
                    <line x1="25" y1="50" x2="75" y2="50" stroke="white" stroke-width="2"/>
                    <circle cx="50" cy="50" r="5" fill="white"/>
                </svg>
                <div class="transition-text">Discovering Your Shared Musical Journey...</div>
            </div>
        </div>


        <div class="carousel-slide artists-slide">
            <div class="slide-content">
                <div class="title">Top Artists</div>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user1.username }}'s Top Artists</h3>
                        <ul class="top-list">
                            {% for artist in duo_wrap.top_artists_comparison.user1 %}
                            <li class="top-item animate__animated animate__fadeInLeft">
                                <span class="item-rank">{{ forloop.counter }}</span>
                                <img class="item-image" src="{{ artist.image_url|default:'/api/placeholder/60/60' }}" alt="{{ artist.name }}">
                                <div class="item-details">
                                    <p class="item-name">{{ artist.name }}</p>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user2.username }}'s Top Artists</h3>
                        <ul class="top-list">
                            {% for artist in duo_wrap.top_artists_comparison.user2 %}
                            <li class="top-item animate__animated animate__fadeInRight">
                                <span class="item-rank">{{ forloop.counter }}</span>
                                <img class="item-image" src="{{ artist.image_url|default:'/api/placeholder/60/60' }}" alt="{{ artist.name }}">
                                <div class="item-details">
                                    <p class="item-name">{{ artist.name }}</p>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transition Songs Slide -->
        <div class="carousel-slide transition-songs">
            <div class="slide-content">
                <svg class="transition-graphic rotate" viewBox="0 0 100 100">
                    <path d="M50 20 L50 80 M20 50 L80 50" stroke="white" stroke-width="2" fill="none"/>
                    <circle cx="35" cy="35" r="10" fill="white"/>
                    <circle cx="65" cy="65" r="10" fill="white"/>
                    <circle cx="35" cy="65" r="10" fill="white"/>
                    <circle cx="65" cy="35" r="10" fill="white"/>
                </svg>
                <div class="transition-text">Comparing Musical Tastes...</div>
            </div>
        </div>

        <!-- Top Songs Comparison Slide -->
        <div class="carousel-slide songs-slide">
            <div class="slide-content">
                <div class="title">Top Songs</div>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user1.username }}'s Top Songs</h3>
                        <ul class="top-list">
                            {% for song in duo_wrap.top_songs_comparison.user1 %}
                            <li class="top-item animate__animated animate__fadeInLeft">
                                <span class="item-rank">{{ forloop.counter }}</span>
                                <img class="item-image" src="{{ song.image_url|default:'/api/placeholder/60/60' }}" alt="{{ song.title }}">
                                <div class="item-details">
                                    <p class="item-name">{{ song.title }}</p>
                                    <small>{{ song.artist }}</small>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user2.username }}'s Top Songs</h3>
                        <ul class="top-list">
                            {% for song in duo_wrap.top_songs_comparison.user2 %}
                            <li class="top-item animate__animated animate__fadeInRight">
                                <span class="item-rank">{{ forloop.counter }}</span>
                                <img class="item-image" src="{{ song.image_url|default:'/api/placeholder/60/60' }}" alt="{{ song.title }}">
                                <div class="item-details">
                                    <p class="item-name">{{ song.title }}</p>
                                    <small>{{ song.artist }}</small>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Genre Transition Slide -->
        <div class="carousel-slide transition-genre">
            <div class="slide-content">
                <svg class="transition-graphic bounce" viewBox="0 0 100 100">
                    <rect x="25" y="30" width="20" height="40" fill="white"/>
                    <rect x="50" y="20" width="20" height="60" fill="white"/>
                    <rect x="75" y="40" width="20" height="20" fill="white"/>
                </svg>
                <div class="transition-text">Analyzing Genre Compatibility...</div>
            </div>
        </div>

        <!-- Genre Comparison Slide with Image Placeholders -->
        <div class="carousel-slide genre-slide">
            <div class="slide-content">
                <div class="versus-divider">VS</div>
                <div class="genre-clash-overlay"></div>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <img class="genre-image animate__animated animate__zoomIn"
                             src="{{ user1_genre_image_url|default:'/api/placeholder/200/200' }}">
                        <div class="highlight">{{ duo_wrap.user1.username }}'s Top Genre</div>
                        <div class="subtitle">{{ duo_wrap.top_genre_comparison.user1 }}</div>
                    </div>
                    <div class="comparison-item">
                        <img class="genre-image animate__animated animate__zoomIn"
                             src="{{ user2_genre_image_url|default:'/api/placeholder/200/200' }}">
                        <div class="highlight">{{ duo_wrap.user2.username }}'s Top Genre</div>
                        <div class="subtitle">{{ duo_wrap.top_genre_comparison.user2 }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Minutes Transition Slide -->
        <div class="carousel-slide transition-minutes">
            <div class="slide-content">
                <svg class="transition-graphic pulse" viewBox="0 0 100 100">
                    <path d="M25 50 L50 25 L75 50" stroke="white" stroke-width="2" fill="none"/>
                    <path d="M25 50 L75 50" stroke="white" stroke-width="2" fill="none"/>
                    <circle cx="25" cy="50" r="5" fill="white"/>
                    <circle cx="75" cy="50" r="5" fill="white"/>
                </svg>
                <div class="transition-text">Calculating Listening Time...</div>
            </div>
        </div>

        <!-- Minutes Listened Comparison Slide -->
        <div class="carousel-slide minutes-slide">
            <div class="slide-content">
                <div class="title">Minutes Listened</div>
                <div class="comparison-container">
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user1.username }}'s Listening Time</h3>
                        <div class="highlight animate__animated animate__zoomIn">{{ duo_wrap.minutes_listened_comparison.user1 }} minutes</div>
                    </div>
                    <div class="comparison-item">
                        <h3>{{ duo_wrap.user2.username }}'s Listening Time</h3>
                        <div class="highlight animate__animated animate__zoomIn">{{ duo_wrap.minutes_listened_comparison.user2 }} minutes</div>
                    </div>
                </div>
                <div class="subtitle animate__animated animate__fadeInUp">See how your listening compares!</div>
            </div>
        </div>


        <!-- Navigation -->
        <div class="navigation-container">
            <div class="nav-buttons">
                <button class="nav-button" onclick="previousSlide()">Previous</button>
                <button class="nav-button" onclick="nextSlide()">Next</button>
            </div>
            <button class="menu-button" onclick="window.location.href='{% url 'main_menu' %}'">Back to Menu</button>
        </div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.carousel-slide');

        function showSlide(index) {
            slides.forEach(slide => slide.classList.remove('active'));

            currentSlide = index;
            if (currentSlide >= slides.length) currentSlide = 0;
            if (currentSlide < 0) currentSlide = slides.length - 1;

            slides[currentSlide].classList.add('active');
        }

        function nextSlide() {
            showSlide(currentSlide + 1);
        }

        function previousSlide() {
            showSlide(currentSlide - 1);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') previousSlide();
        });
    </script>
</body>
</html>
